{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Mi Perfil" %} - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
    /* ===== Profile Dashboard - SaaS Card Layout ===== */
    .profile-page {
        padding: 1.5rem 2rem;
        max-width: 1400px;
        margin: 0 auto;
    }

    .profile-header {
        margin-bottom: 1.5rem;
    }

    .profile-header h1 {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1e293b;
        margin: 0 0 0.25rem 0;
    }

    .profile-header p {
        color: #64748b;
        font-size: 0.9375rem;
        margin: 0;
    }

    /* Profile Cards */
    .profile-card {
        background: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 0.875rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
        margin-bottom: 1.5rem;
        overflow: hidden;
    }

    .profile-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #f1f5f9;
        background: #fafbfc;
    }

    .profile-card-header.header-blue { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
    .profile-card-header.header-green { background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); }
    .profile-card-header.header-red { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
    .profile-card-header.header-cyan { background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); }
    
    .profile-card-header.header-blue,
    .profile-card-header.header-green,
    .profile-card-header.header-red,
    .profile-card-header.header-cyan {
        border-bottom: none;
    }
    
    .profile-card-header.header-blue .profile-card-title,
    .profile-card-header.header-green .profile-card-title,
    .profile-card-header.header-red .profile-card-title,
    .profile-card-header.header-cyan .profile-card-title {
        color: #ffffff;
    }
    
    .profile-card-header.header-blue .profile-card-title svg,
    .profile-card-header.header-green .profile-card-title svg,
    .profile-card-header.header-red .profile-card-title svg,
    .profile-card-header.header-cyan .profile-card-title svg {
        color: rgba(255,255,255,0.9);
    }

    .profile-card-title {
        font-size: 1rem;
        font-weight: 600;
        color: #334155;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .profile-card-title svg {
        color: #3b82f6;
    }

    .profile-card-action {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.875rem;
        font-size: 0.8125rem;
        font-weight: 500;
        color: #3b82f6;
        background: #ffffff;
        border: 1px solid #e2e8f0;
        border-radius: 0.5rem;
        text-decoration: none;
        transition: all 0.15s ease;
    }

    .profile-card-action:hover {
        background: #f8fafc;
        border-color: #3b82f6;
    }

    .profile-card-body {
        padding: 1.5rem;
    }

    /* Profile Avatar Section */
    .profile-avatar-section {
        display: flex;
        align-items: center;
        gap: 1.25rem;
        padding-bottom: 1.5rem;
        margin-bottom: 1.5rem;
        border-bottom: 1px solid #f1f5f9;
    }

    .profile-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        object-fit: cover;
        border: 3px solid #e2e8f0;
    }

    .profile-avatar-placeholder {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background: linear-gradient(135deg, #94a3b8 0%, #64748b 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #ffffff;
    }

    .profile-avatar-info h3 {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0 0 0.25rem 0;
    }

    .profile-avatar-info .email {
        color: #64748b;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    .profile-avatar-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .profile-avatar-actions {
        margin-left: auto;
        display: flex;
        gap: 0.5rem;
        align-items: center;
    }

    /* Grid Layout for Fields */
    .profile-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
    }

    .profile-grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.25rem;
    }

    @media (max-width: 1024px) {
        .profile-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    @media (max-width: 640px) {
        .profile-grid, .profile-grid-2 {
            grid-template-columns: 1fr;
        }
        
        .profile-avatar-section {
            flex-direction: column;
            text-align: center;
        }
        
        .profile-avatar-actions {
            margin-left: 0;
            margin-top: 1rem;
        }
        
        .profile-page {
            padding: 1rem;
        }
    }

    /* Cards Grid Layout */
    .profile-cards-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1.5rem;
    }

    @media (max-width: 1024px) {
        .profile-cards-grid {
            grid-template-columns: 1fr;
        }
    }

    /* Profile Field Component */
    .profile-field {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .profile-field-icon {
        flex-shrink: 0;
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f1f5f9;
        border-radius: 0.5rem;
        color: #64748b;
    }

    .profile-field-content {
        flex: 1;
        min-width: 0;
    }

    .profile-field-label {
        display: block;
        font-size: 0.8125rem;
        font-weight: 600;
        color: #475569;
        margin-bottom: 0.25rem;
    }

    .profile-field-value {
        display: block;
        font-size: 0.9375rem;
        color: #64748b;
        word-break: break-word;
    }

    /* Badges */
    .profile-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.625rem;
        font-size: 0.75rem;
        font-weight: 500;
        border-radius: 9999px;
    }

    .profile-badge-success {
        background: #dcfce7;
        color: #166534;
    }

    .profile-badge-warning {
        background: #fef3c7;
        color: #92400e;
    }

    .profile-badge-info {
        background: #dbeafe;
        color: #1e40af;
    }

    .profile-badge-danger {
        background: #fee2e2;
        color: #991b1b;
    }

    .profile-badge-secondary {
        background: #f1f5f9;
        color: #475569;
    }

    /* Code fields */
    .profile-field-code-wrapper {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
    }

    .profile-field-code {
        display: inline-block;
        padding: 0.25rem 0.5rem;
        font-size: 0.8125rem;
        font-family: 'SF Mono', 'Consolas', monospace;
        background: #f8fafc;
        border: 1px solid #e2e8f0;
        border-radius: 0.375rem;
        color: #475569;
    }

    .profile-copy-btn {
        padding: 0.25rem;
        background: transparent;
        border: none;
        color: #94a3b8;
        cursor: pointer;
        border-radius: 0.25rem;
        transition: all 0.15s ease;
    }

    .profile-copy-btn:hover {
        color: #3b82f6;
        background: #eff6ff;
    }

    /* Technical Details Section */
    .profile-technical {
        background: #f8fafc;
        border-radius: 0.5rem;
        padding: 1rem 1.25rem;
        margin-top: 1.5rem;
    }

    .profile-technical-title {
        font-size: 0.75rem;
        font-weight: 600;
        color: #94a3b8;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
    }

    .profile-technical .profile-grid {
        gap: 1rem;
    }

    .profile-technical .profile-field-icon {
        width: 28px;
        height: 28px;
        background: #e2e8f0;
    }

    .profile-technical .profile-field-icon svg {
        width: 14px;
        height: 14px;
    }

    /* Section within card */
    .profile-section {
        margin-bottom: 1.5rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #f1f5f9;
    }

    .profile-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
    }

    .profile-section-title {
        font-size: 0.875rem;
        font-weight: 600;
        color: #334155;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .profile-section-title svg {
        color: #64748b;
    }

    /* Status indicators */
    .status-enabled {
        color: #16a34a;
    }

    .status-disabled {
        color: #dc2626;
    }

    /* Button styles within cards */
    .profile-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.5rem 1rem;
        font-size: 0.8125rem;
        font-weight: 500;
        border-radius: 0.5rem;
        text-decoration: none;
        transition: all 0.15s ease;
        border: 1px solid transparent;
    }

    .profile-btn-primary {
        background: #3b82f6;
        color: #ffffff;
    }

    .profile-btn-primary:hover {
        background: #2563eb;
        color: #ffffff;
    }

    .profile-btn-outline {
        background: transparent;
        border-color: #e2e8f0;
        color: #475569;
    }

    .profile-btn-outline:hover {
        background: #f8fafc;
        border-color: #cbd5e1;
    }

    .profile-btn-success {
        background: #22c55e;
        color: #ffffff;
    }

    .profile-btn-success:hover {
        background: #16a34a;
        color: #ffffff;
    }

    .profile-btn-danger {
        background: transparent;
        border-color: #fecaca;
        color: #dc2626;
    }

    .profile-btn-danger:hover {
        background: #fef2f2;
    }

    .profile-btn-sm {
        padding: 0.375rem 0.75rem;
        font-size: 0.75rem;
    }

    /* Alert boxes */
    .profile-alert {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.8125rem;
        margin-bottom: 0.75rem;
    }

    .profile-alert-success {
        background: #dcfce7;
        color: #166534;
    }

    .profile-alert-warning {
        background: #fef3c7;
        color: #92400e;
    }

    /* Empty state */
    .profile-empty {
        text-align: center;
        padding: 2rem;
        color: #94a3b8;
    }

    .profile-empty svg {
        margin-bottom: 0.75rem;
        opacity: 0.5;
    }

    /* Notification item */
    .notification-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.375rem 0;
    }

    .notification-item .status-icon {
        width: 18px;
        height: 18px;
    }

    /* Company logo */
    .company-logo {
        max-height: 60px;
        border-radius: 0.375rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="profile-page">
    <!-- Page Header -->
    <div class="profile-header">
        <h1>{% trans "Mi Perfil" %}</h1>
        <p>{% trans "Gestiona tu información personal y operativa para poder crear pedidos" %}</p>
    </div>

    <!-- Cards Grid 2x2 -->
    <div class="profile-cards-grid">
        <!-- Card A: Datos Personales -->
        <div class="profile-card">
            <div class="profile-card-header header-blue">
                <h2 class="profile-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/><path d="M8 14h.01"/><path d="M12 14h.01"/><path d="M16 14h.01"/><path d="M8 18h.01"/><path d="M12 18h.01"/><path d="M16 18h.01"/></svg>
                    {% trans "Mi Perfil" %}
                </h2>
                <a href="{% url 'accounts:update_complete_profile' %}" class="profile-card-action">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    {% trans "Editar" %}
                </a>
            </div>
            <div class="profile-card-body">
                <!-- Avatar Section -->
                <div class="profile-avatar-section">
                    {% if user.avatar %}
                        <img src="{{ user.avatar.url }}" alt="{{ user.display_name }}" class="profile-avatar">
                    {% else %}
                        <div class="profile-avatar-placeholder">
                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                    {% endif %}
                    <div class="profile-avatar-info">
                        <h3>{{ user.display_name|default:user.email }}</h3>
                        <div class="email">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>
                            {{ user.email }}
                        </div>
                        <div class="profile-avatar-badges">
                            {% if user.is_active %}
                                <span class="profile-badge profile-badge-success">{% trans "Activo" %}</span>
                            {% else %}
                                <span class="profile-badge profile-badge-secondary">{% trans "Inactivo" %}</span>
                            {% endif %}
                            <span class="profile-badge profile-badge-info">{{ user.get_role_display }}</span>
                        </div>
                    </div>
                    <div class="profile-avatar-actions">
                        <a href="{% url 'accounts:upload_avatar' %}" class="profile-btn profile-btn-outline profile-btn-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>
                            {% trans "Cambiar foto" %}
                        </a>
                        {% if user.avatar %}
                        <form method="post" action="{% url 'accounts:delete_avatar' %}" style="display:inline;" onsubmit="return confirm('{% trans "¿Eliminar foto de perfil?" %}');">
                            {% csrf_token %}
                            <button type="submit" class="profile-btn profile-btn-danger profile-btn-sm" title="{% trans 'Eliminar foto' %}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </div>

                <!-- Personal Information Grid -->
                <div class="profile-grid">
                    <!-- Identidad -->
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Nombre" %}</span>
                            <span class="profile-field-value">{{ user.first_name|default:"-" }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Apellido" %}</span>
                            <span class="profile-field-value">{{ user.last_name|default:"-" }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Teléfono" %}</span>
                            <span class="profile-field-value">{{ user.phone|default:"-" }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Idioma" %}</span>
                            <span class="profile-field-value">{{ user.get_language_display }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Zona Horaria" %}</span>
                            <span class="profile-field-value">{{ user.timezone }}</span>
                        </div>
                    </div>
                    
                    <div class="profile-field">
                        <div class="profile-field-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3.85 8.62a4 4 0 0 1 4.78-4.77 4 4 0 0 1 6.74 0 4 4 0 0 1 4.78 4.78 4 4 0 0 1 0 6.74 4 4 0 0 1-4.77 4.78 4 4 0 0 1-6.75 0 4 4 0 0 1-4.78-4.77 4 4 0 0 1 0-6.76Z"/><path d="m9 12 2 2 4-4"/></svg>
                        </div>
                        <div class="profile-field-content">
                            <span class="profile-field-label">{% trans "Estado" %}</span>
                            {% if user.is_active %}
                                <span class="profile-badge profile-badge-success">{% trans "Activo" %}</span>
                            {% else %}
                                <span class="profile-badge profile-badge-secondary">{% trans "Inactivo" %}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Technical Details Section -->
                <div class="profile-technical">
                    <div class="profile-technical-title">{% trans "Detalles Técnicos" %}</div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "ID Interno" %}</span>
                                <code class="profile-field-code">#{{ user.id }}</code>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Fecha de Registro" %}</span>
                                <span class="profile-field-value">{{ user.date_joined|date:"d/m/Y H:i" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Último Acceso" %}</span>
                                <span class="profile-field-value">
                                    {% if user.last_login_at %}
                                        {{ user.last_login_at|date:"d/m/Y H:i" }}
                                        <br><small style="color:#94a3b8">{{ user.last_login_ip }}</small>
                                    {% else %}
                                        -
                                    {% endif %}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {% if False %}<!-- Card B: Empresa/Organización -->
        <div class="profile-card">
            <div class="profile-card-header header-green">
                <h2 class="profile-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></svg>
                    {% trans "Empresa / Organización" %}
                </h2>
                {% if user_company %}
                <a href="{% url 'accounts:update_company_data' %}" class="profile-card-action">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    {% trans "Editar" %}
                </a>
                {% endif %}
            </div>
            <div class="profile-card-body">
                {% if user_company %}
                    {% with company=user_company.company %}
                    {% if company.logo %}
                    <div style="margin-bottom: 1rem;">
                        <img src="{{ company.logo.url }}" alt="{{ company.name }}" class="company-logo">
                    </div>
                    {% endif %}

                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Empresa" %}</span>
                                <span class="profile-field-value" style="font-weight:600;color:#1e293b;">{{ company.name }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "NIF/CIF" %}</span>
                                <span class="profile-field-value">{{ company.vat_number|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/><rect width="20" height="14" x="2" y="6" rx="2"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Sector" %}</span>
                                <span class="profile-badge profile-badge-info">{{ company.get_sector_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Tamaño" %}</span>
                                <span class="profile-badge profile-badge-secondary">{{ company.get_size_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "País" %}</span>
                                <span class="profile-field-value">{{ company.country|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Ciudad" %}</span>
                                <span class="profile-field-value">{{ company.city|default:"-" }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="profile-technical" style="margin-top:1.25rem;">
                        <div class="profile-technical-title">{% trans "Tu posición" %}</div>
                        <div class="profile-grid">
                            <div class="profile-field">
                                <div class="profile-field-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></svg>
                                </div>
                                <div class="profile-field-content">
                                    <span class="profile-field-label">{% trans "Cargo" %}</span>
                                    <span class="profile-field-value">{{ user_company.job_title|default:"-" }}</span>
                                </div>
                            </div>
                            
                            <div class="profile-field">
                                <div class="profile-field-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                                </div>
                                <div class="profile-field-content">
                                    <span class="profile-field-label">{% trans "Rol" %}</span>
                                    {% if user_company.is_company_admin %}
                                        <span class="profile-badge profile-badge-warning">{% trans "Administrador" %}</span>
                                    {% else %}
                                        <span class="profile-badge profile-badge-secondary">{% trans "Usuario" %}</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="profile-field">
                                <div class="profile-field-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                                </div>
                                <div class="profile-field-content">
                                    <span class="profile-field-label">{% trans "Unido el" %}</span>
                                    <span class="profile-field-value">{{ user_company.joined_at|date:"d/m/Y" }}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endwith %}
                {% else %}
                    <div class="profile-empty">
                        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/></svg>
                        <p>{% trans "No estás asociado a ninguna empresa" %}</p>
                    </div>
                {% endif %}
            </div>
        </div>{% endif %}

        {% if False %}<!-- Card C: Seguridad -->
        <div class="profile-card">
            <div class="profile-card-header header-red">
                <h2 class="profile-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                    {% trans "Seguridad" %}
                </h2>
                <a href="{% url 'accounts:update_security' %}" class="profile-card-action">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    {% trans "Editar" %}
                </a>
            </div>
            <div class="profile-card-body">
                <!-- Contraseña -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
                        {% trans "Contraseña" %}
                    </div>
                    <div class="profile-grid-2">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Última actualización" %}</span>
                                <span class="profile-field-value">{{ security.password_changed_at|date:"d/m/Y"|default:"-" }}</span>
                            </div>
                        </div>
                        <div>
                            <a href="{% url 'accounts:change_password' %}" class="profile-btn profile-btn-outline profile-btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                                {% trans "Cambiar contraseña" %}
                            </a>
                        </div>
                    </div>
                </div>

                <!-- 2FA -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="20" x="5" y="2" rx="2" ry="2"/><path d="M12 18h.01"/></svg>
                        {% trans "Autenticación de Dos Factores" %}
                    </div>
                    {% if security.two_factor_enabled %}
                        <div class="profile-alert profile-alert-success">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            {% trans "Habilitado" %} ({{ security.get_two_factor_method_display }})
                        </div>
                        <form method="post" action="{% url 'accounts:disable_2fa' %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="profile-btn profile-btn-danger profile-btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" x2="6" y1="6" y2="18"/><line x1="6" x2="18" y1="6" y2="18"/></svg>
                                {% trans "Deshabilitar 2FA" %}
                            </button>
                        </form>
                    {% else %}
                        <div class="profile-alert profile-alert-warning">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                            {% trans "Deshabilitado" %}
                        </div>
                        <form method="post" action="{% url 'accounts:enable_2fa' %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="profile-btn profile-btn-success profile-btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
                                {% trans "Habilitar 2FA" %}
                            </button>
                        </form>
                    {% endif %}
                </div>

                <!-- Sesiones y Links -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>
                        {% trans "Sesiones Activas" %}
                    </div>
                    <div style="display:flex;align-items:center;gap:1rem;margin-bottom:0.75rem;">
                        <span class="profile-badge profile-badge-info" style="font-size:1rem;padding:0.375rem 0.75rem;">{{ session_count }}</span>
                        <span style="color:#64748b;font-size:0.875rem;">{% trans "sesión(es) activa(s)" %}</span>
                    </div>
                    <div style="display:flex;gap:0.5rem;flex-wrap:wrap;">
                        <a href="{% url 'accounts:active_sessions' %}" class="profile-btn profile-btn-outline profile-btn-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                            {% trans "Ver sesiones" %}
                        </a>
                        <a href="{% url 'accounts:login_history' %}" class="profile-btn profile-btn-outline profile-btn-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>
                            {% trans "Historial" %}
                        </a>
                        <a href="{% url 'accounts:audit_log' %}" class="profile-btn profile-btn-outline profile-btn-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            {% trans "Auditoría" %}
                        </a>
                    </div>
                </div>

                <!-- API Token -->
                <div class="profile-section" style="border-bottom:none;padding-bottom:0;margin-bottom:0;">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
                        {% trans "Token de API" %}
                    </div>
                    {% if security.api_token %}
                        <div style="margin-bottom:0.75rem;">
                            <input type="password" class="profile-field-code" style="width:100%;max-width:300px;padding:0.5rem;" value="{{ security.api_token }}" readonly id="apiToken">
                            <small style="display:block;color:#94a3b8;margin-top:0.25rem;">{% trans "Creado" %}: {{ security.api_token_created_at|date:"d/m/Y H:i" }}</small>
                        </div>
                        <div style="display:flex;gap:0.5rem;">
                            <button type="button" class="profile-btn profile-btn-outline profile-btn-sm" onclick="toggleTokenVisibility()">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"/><circle cx="12" cy="12" r="3"/></svg>
                                {% trans "Mostrar" %}
                            </button>
                            <form method="post" action="{% url 'accounts:revoke_api_token' %}" style="display:inline;">
                                {% csrf_token %}
                                <button type="submit" class="profile-btn profile-btn-danger profile-btn-sm">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                                    {% trans "Revocar" %}
                                </button>
                            </form>
                        </div>
                    {% else %}
                        <form method="post" action="{% url 'accounts:generate_api_token' %}">
                            {% csrf_token %}
                            <button type="submit" class="profile-btn profile-btn-success profile-btn-sm">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>
                                {% trans "Generar Token" %}
                            </button>
                        </form>
                    {% endif %}
                </div>
            </div>
        </div>{% endif %}

        {% if False %}<!-- Card D: Preferencias -->
        <div class="profile-card">
            <div class="profile-card-header header-cyan">
                <h2 class="profile-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                    {% trans "Preferencias" %}
                </h2>
                <a href="{% url 'accounts:update_preferences' %}" class="profile-card-action">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    {% trans "Editar" %}
                </a>
            </div>
            <div class="profile-card-body">
                <!-- Interfaz -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>
                        {% trans "Interfaz" %}
                    </div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Tema" %}</span>
                                <span class="profile-field-value">{{ preferences.get_theme_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Idioma" %}</span>
                                <span class="profile-field-value">{{ preferences.get_language_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Zona Horaria" %}</span>
                                <span class="profile-field-value">{{ preferences.timezone }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notificaciones -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>
                        {% trans "Notificaciones" %}
                    </div>
                    <div class="profile-grid">
                        <div class="notification-item">
                            {% if preferences.email_notifications %}
                                <svg class="status-icon status-enabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            {% else %}
                                <svg class="status-icon status-disabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
                            {% endif %}
                            <span style="font-size:0.875rem;color:#475569;">{% trans "Email" %}</span>
                        </div>
                        <div class="notification-item">
                            {% if preferences.platform_notifications %}
                                <svg class="status-icon status-enabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            {% else %}
                                <svg class="status-icon status-disabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
                            {% endif %}
                            <span style="font-size:0.875rem;color:#475569;">{% trans "Plataforma" %}</span>
                        </div>
                        <div class="notification-item">
                            {% if preferences.marketing_emails %}
                                <svg class="status-icon status-enabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                            {% else %}
                                <svg class="status-icon status-disabled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
                            {% endif %}
                            <span style="font-size:0.875rem;color:#475569;">{% trans "Marketing" %}</span>
                        </div>
                    </div>
                </div>

                <!-- IA -->
                <div class="profile-section" style="border-bottom:none;padding-bottom:0;margin-bottom:0;">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                        {% trans "Asistente IA" %}
                    </div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" x2="22" y1="12" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Idioma IA" %}</span>
                                <span class="profile-field-value">{{ preferences.get_ai_language_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 20h.01"/><path d="M7 20v-4"/><path d="M12 20v-8"/><path d="M17 20V8"/><path d="M22 4v16"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Nivel de Detalle" %}</span>
                                <span class="profile-badge profile-badge-info">{{ preferences.get_ai_detail_level_display }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Formato" %}</span>
                                <span class="profile-badge profile-badge-secondary">{{ preferences.get_ai_format_display }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>{% endif %}

        {% if False %}<!-- Card E: Perfil Operativo -->
        <div class="profile-card">
            <div class="profile-card-header header-cyan">
                <h2 class="profile-card-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0"/><path d="M9 11c2 -5 4 -8 3 -14c-4 1 -9 5.5 -9 10.5c0 5.207 4.021 9.697 9 10.5"/><path d="M12 12m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/><path d="M15 9m-1 0a1 1 0 1 0 2 0a1 1 0 1 0 -2 0"/></svg>
                    {% trans "Perfil Operativo" %}
                </h2>
                <a href="{% url 'accounts:update_operative_profile' %}" class="profile-card-action">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                    {% trans "Editar" %}
                </a>
            </div>
            <div class="profile-card-body">
                <!-- Status Banner -->
                {% if user.profile_completed %}
                    <div class="profile-alert profile-alert-success">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                        {% trans "Perfil Completo" %} - {% trans "Puedes crear pedidos" %}
                    </div>
                {% else %}
                    <div class="profile-alert profile-alert-warning">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" x2="12" y1="9" y2="13"/><line x1="12" x2="12.01" y1="17" y2="17"/></svg>
                        {% trans "Incompleto" %} ({{ user.missing_fields|length }} {% trans "campos" %})
                    </div>
                {% endif %}

                <!-- Operativo Info Grid -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2Z"/><line x1="9" x2="15" y1="13" y2="13"/></svg>
                        {% trans "Contacto" %}
                    </div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Teléfono Reparto" %}</span>
                                <span class="profile-field-value">{{ user.telefono_reparto|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Teléfono Empresa" %}</span>
                                <span class="profile-field-value">{{ user.telefono_empresa|default:"-" }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dirección Info -->
                <div class="profile-section">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/><circle cx="12" cy="10" r="3"/></svg>
                        {% trans "Dirección Local" %}
                    </div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Dirección" %}</span>
                                <span class="profile-field-value" style="font-size:0.875rem;">{{ user.direccion_local|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="10" r="3"/><path if="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Ciudad" %}</span>
                                <span class="profile-field-value">{{ user.ciudad|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Provincia" %}</span>
                                <span class="profile-field-value">{{ user.provincia|default:"-" }}</span>
                            </div>
                        </div>
                        
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1v22M4.22 4.22l15.56 15.56M1 12h22"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Código Postal" %}</span>
                                <span class="profile-field-value">{{ user.codigo_postal|default:"-" }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tipo de Entrega -->
                <div class="profile-section" style="border-bottom:none;padding-bottom:0;margin-bottom:0;">
                    <div class="profile-section-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="1" height="1" x="3" y="5" rx=".1"/><path d="M2 5a1 1 0 0 1 1-1h.972m16.029 0a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1h-2.038a1 1 0 0 0-.853.393l-.771 1.028a1 1 0 0 1-1.693-.393V5"/><path d="M9 9h1m4 0h1M9 13h1m4 0h1"/></svg>
                        {% trans "Entrega" %}
                    </div>
                    <div class="profile-grid">
                        <div class="profile-field">
                            <div class="profile-field-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 12l2 2 4-4"/><circle cx="12" cy="12" r="9"/></svg>
                            </div>
                            <div class="profile-field-content">
                                <span class="profile-field-label">{% trans "Tipo" %}</span>
                                <span class="profile-badge profile-badge-info">{{ user.get_tipo_entrega_display|default:"-" }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>{% endif %}
    </div>
</div>

<script>
function toggleTokenVisibility() {
    const tokenInput = document.getElementById('apiToken');
    if (tokenInput.type === 'password') {
        tokenInput.type = 'text';
    } else {
        tokenInput.type = 'password';
    }
}

function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        const btn = event.currentTarget;
        const originalColor = btn.style.color;
        btn.style.color = '#22c55e';
        setTimeout(() => { btn.style.color = originalColor; }, 1500);
    }).catch(function(err) {
        console.error('Error al copiar: ', err);
    });
}
</script>
{% endblock %}
