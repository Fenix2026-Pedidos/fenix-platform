{% load i18n static %}
{% get_current_language as CURRENT_LANG %}
<!DOCTYPE html>
<html lang="{{ CURRENT_LANG }}">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Fenix - Plataforma de GestiÃ³n de Pedidos{% endblock %}</title>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'favicon.png' %}">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <!-- Custom Theme CSS -->
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff', 100: '#dbeafe', 200: '#bfdbfe', 300: '#93c5fd', 400: '#60a5fa',
                            500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8', 800: '#1e40af', 900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>

    <!-- WhatsApp FAB CSS - Solo en zona pÃºblica -->
    {% if not user.is_authenticated %}
    <link rel="stylesheet" href="{% static 'css/whatsapp.css' %}">
    {% endif %}

    {% block extra_css %}{% endblock %}
</head>

<body>
    <div class="app-layout">
        {% if user.is_authenticated %}
        {% include 'components/sidebar.html' %}
        {% endif %}

        <div class="main-content{% if not user.is_authenticated %} no-sidebar{% endif %}">
            {% if user.is_authenticated %}
            {% include 'components/topbar.html' %}
            {% else %}
            <!-- Public Header (Senior React + Tailwind Style) -->
            <header class="w-full bg-blue-700 shadow-sm border-b border-blue-800/50">
                <div class="max-w-screen-xl mx-auto px-4 md:px-6">
                    <div class="flex items-center justify-between h-16">

                        <!-- LEFT - Logo -->
                        <div class="flex items-center flex-shrink-0">
                            <a href="/" class="flex items-center">
                                <img src="{% static 'img/fenix-logo.svg' %}" alt="Fenix"
                                    class="h-8 md:h-9 w-auto object-contain" />
                            </a>
                        </div>

                        <!-- RIGHT - Actions -->
                        <div class="flex items-center gap-2 md:gap-4">
                            <!-- Compact Language Selector -->
                            <form action="{% url 'set_language' %}" method="post" class="flex items-center"
                                id="public-lang-form">
                                {% csrf_token %}
                                <input name="next" type="hidden" value="{{ request.get_full_path }}">
                                {% get_current_language as CURRENT_LANGUAGE %}
                                {% get_available_languages as LANGUAGES_LIST %}

                                <div class="relative group">
                                    <select name="language" onchange="this.form.submit()"
                                        class="appearance-none bg-blue-600/50 hover:bg-blue-600 border border-blue-500/30 rounded-lg px-3 py-1.5 text-xs font-semibold text-white cursor-pointer transition-all flex items-center gap-2 pr-8 focus:outline-none focus:ring-2 focus:ring-blue-400/50">
                                        {% for lang_code, lang_name in LANGUAGES_LIST %}
                                        {% if lang_code != 'en' %}
                                        <option value="{{ lang_code }}" {% if lang_code==CURRENT_LANGUAGE %}selected{%
                                            endif %} class="text-gray-900 bg-white">
                                            {% if lang_code == 'es' %}ðŸ‡ªðŸ‡¸ ES
                                            {% elif lang_code == 'zh-hans' %}ðŸ‡¨ðŸ‡³ ZH
                                            {% else %}{{ lang_code|upper }}{% endif %}
                                        </option>
                                        {% endif %}
                                        {% endfor %}
                                    </select>
                                    <div
                                        class="absolute right-2.5 top-1/2 -translate-y-1/2 pointer-events-none text-blue-200">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none"
                                            viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>
                            </form>

                            <!-- Auth Buttons Desktop -->
                            <div class="hidden md:flex items-center gap-3">
                                <a href="{% url 'accounts:login' %}"
                                    class="px-4 py-2 text-sm font-medium text-white hover:text-blue-100 transition">
                                    {% trans "Iniciar SesiÃ³n" %}
                                </a>
                                <a href="{% url 'accounts:register' %}"
                                    class="px-4 py-2 bg-white text-blue-700 hover:bg-blue-50 rounded-lg text-sm font-bold shadow-sm transition transform hover:scale-[1.02] active:scale-[0.98]">
                                    {% trans "Registrarse" %}
                                </a>
                            </div>

                            <!-- Mobile Menu Trigger (Optional but professional) -->
                            <div class="flex md:hidden">
                                <a href="{% url 'accounts:login' %}" class="p-2 text-white" aria-label="Login">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                                    </svg>
                                </a>
                            </div>
                        </div>

                    </div>
                </div>
            </header>
            {% endif %}

            <div class="content-wrapper">
                {% if messages %}
                <div class="messages">
                    {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i
                            class="bi bi-{% if message.tags == 'success' %}check-circle{% elif message.tags == 'error' or message.tags == 'danger' %}exclamation-triangle{% elif message.tags == 'warning' %}exclamation-circle{% else %}info-circle{% endif %}"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"
                            style="background: none; border: none; font-size: 18px; cursor: pointer; margin-left: auto;">&times;</button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                {% block content %}{% endblock %}
            </div>
        </div>
    </div>

    <!-- WhatsApp FAB - Solo visible en zona pÃºblica -->
    {% if not user.is_authenticated %}
    {% include 'public/partials/whatsapp_fab.html' %}
    {% endif %}

    <!-- Bootstrap JS (for dropdowns) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- WhatsApp FAB JS - Solo en zona pÃºblica -->
    {% if not user.is_authenticated %}
    <script src="{% static 'js/whatsapp.js' %}"></script>
    {% endif %}

    {% block extra_js %}{% endblock %}
</body>

</html>