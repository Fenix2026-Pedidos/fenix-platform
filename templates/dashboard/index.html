{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{% trans "Inicio" %} - {{ block.super }}{% endblock %}

{% block content %}
<!-- Hero Saludo Inteligente -->
{% include 'components/hero_greeting.html' %}

<!-- Dashboard Grid 2x2 -->
<div class="dashboard-container">
    <div class="dashboard-grid">
        <!-- Card 1: Mis Pedidos -->
        <div class="dash-card">
            <div class="dash-card-header">
                <span class="dash-icon dash-icon-blue"></span>
                <div class="dash-header-text">
                    <h3>{% trans "Mis Pedidos" %}</h3>
                    <p>{% trans "Estado de tus pedidos actuales" %}</p>
                </div>
            </div>
            <div class="dash-card-body">
                <div class="dash-stats">
                    <div class="dash-stat-box">
                        <span class="dash-stat-number">{{ active_orders_count }}</span>
                        <span class="dash-stat-label">{% trans "Pedidos activos" %}</span>
                    </div>
                    <div class="dash-stat-box">
                        <span class="dash-stat-number">{{ pending_orders_count }}</span>
                        <span class="dash-stat-label">{% trans "Pendientes" %}</span>
                    </div>
                </div>
                {% if last_order %}
                <p class="dash-info">{% trans "Último pedido" %}: #{{ last_order.id }} - {{ last_order.created_at|date:"d/m/Y" }}</p>
                {% endif %}
                <a href="{% url 'orders:order_list' %}" class="dash-btn">{% trans "Ver pedidos" %}</a>
            </div>
        </div>

        <!-- Card 2: Oferta Especial -->
        <div class="dash-card">
            <div class="dash-card-header">
                <span class="dash-icon dash-icon-yellow"></span>
                <div class="dash-header-text">
                    <h3>{% trans "Oferta especial" %}</h3>
                    <p>{% trans "Oferta especial activa" %}</p>
                </div>
            </div>
            <div class="dash-card-body">
                {% if active_promotion %}
                <div class="dash-promo">
                    <p>{{ active_promotion.description }}</p>
                </div>
                {% else %}
                <p class="dash-empty">{% trans "No hay promociones activas en este momento" %}</p>
                {% endif %}
            </div>
        </div>

        <!-- Card 3: Acciones Pendientes -->
        <div class="dash-card">
            <div class="dash-card-header">
                <span class="dash-icon dash-icon-cyan"></span>
                <div class="dash-header-text">
                    <h3>{% trans "Acciones Pendientes" %}</h3>
                    <p>{% trans "Tareas que requieren tu atención" %}</p>
                </div>
            </div>
            <div class="dash-card-body">
                {% if pending_actions_count > 0 %}
                <div class="dash-alert dash-alert-warning">
                    {% blocktrans count counter=pending_actions_count %}
                        Tienes {{ counter }} acción pendiente
                    {% plural %}
                        Tienes {{ counter }} acciones pendientes
                    {% endblocktrans %}
                </div>
                {% else %}
                <div class="dash-alert dash-alert-success">
                    {% trans "No tienes acciones pendientes" %}
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Card 4: Actividad Reciente -->
        <div class="dash-card">
            <div class="dash-card-header">
                <span class="dash-icon dash-icon-green"></span>
                <div class="dash-header-text">
                    <h3>{% trans "Actividad Reciente" %}</h3>
                    <p>{% trans "Tu última actividad en la plataforma" %}</p>
                </div>
            </div>
            <div class="dash-card-body">
                {% if recent_order %}
                <p class="dash-activity-title">{% trans "Pedido actualizado" %}</p>
                <p class="dash-activity-detail">#{{ recent_order.id }} - {{ recent_order.get_status_display }}</p>
                <p class="dash-activity-time">{{ recent_order.updated_at|timesince }} {% trans "atrás" %}</p>
                {% else %}
                <p class="dash-empty">{% trans "No hay actividad reciente" %}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<style>
/* ===== DASHBOARD CONTAINER ===== */
.dashboard-container {
    padding: 1.5rem 2rem;
    width: 100%;
}

/* ===== GRID 2x2 ===== */
.dashboard-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.25rem;
}

@media (max-width: 768px) {
    .dashboard-container {
        padding: 1rem;
    }
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}

/* ===== CARD BASE ===== */
.dash-card {
    background: #fff;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 1.5rem;
    min-height: 220px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* ===== CARD HEADER ===== */
.dash-card-header {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    margin-bottom: 1rem;
}

.dash-icon {
    width: 24px;
    height: 24px;
    border-radius: 4px;
    flex-shrink: 0;
    margin-top: 2px;
}

.dash-icon-blue { background: #4dabf7; }
.dash-icon-yellow { background: #ffd43b; }
.dash-icon-cyan { background: #22b8cf; }
.dash-icon-green { background: #69db7c; }

.dash-header-text h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #212529;
    margin: 0 0 0.25rem 0;
    line-height: 1.3;
}

.dash-header-text p {
    font-size: 0.8125rem;
    color: #868e96;
    margin: 0;
    line-height: 1.4;
}

/* ===== CARD BODY ===== */
.dash-card-body {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

/* ===== STATS ===== */
.dash-stats {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.dash-stat-box {
    flex: 1;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 6px;
    padding: 1rem 0.75rem;
    text-align: center;
}

.dash-stat-number {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: #228be6;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.dash-stat-label {
    display: block;
    font-size: 0.75rem;
    color: #868e96;
}

/* ===== INFO & BUTTON ===== */
.dash-info {
    font-size: 0.8125rem;
    color: #495057;
    margin: 0 0 1rem 0;
}

.dash-btn {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: #228be6;
    color: #fff;
    text-decoration: none;
    border-radius: 4px;
    font-size: 0.875rem;
    font-weight: 500;
    margin-top: auto;
    align-self: flex-start;
}

.dash-btn:hover {
    background: #1c7ed6;
    color: #fff;
}

/* ===== PROMO ===== */
.dash-promo {
    background: #f8f9fa;
    border-left: 3px solid #40c057;
    padding: 1rem;
    border-radius: 4px;
    margin: auto 0;
}

.dash-promo p {
    margin: 0;
    font-size: 0.9375rem;
    color: #212529;
}

/* ===== EMPTY STATE ===== */
.dash-empty {
    color: #868e96;
    font-size: 0.875rem;
    text-align: center;
    padding: 1.5rem 0;
    margin: auto 0;
}

/* ===== ALERTS ===== */
.dash-alert {
    padding: 0.875rem 1rem;
    border-radius: 4px;
    font-size: 0.875rem;
    margin: auto 0;
}

.dash-alert-success {
    background: #d3f9d8;
    color: #2b8a3e;
}

.dash-alert-warning {
    background: #fff3bf;
    color: #e67700;
}

/* ===== ACTIVITY ===== */
.dash-activity-title {
    font-weight: 600;
    color: #212529;
    margin: 0 0 0.25rem 0;
    font-size: 0.875rem;
}

.dash-activity-detail {
    color: #495057;
    margin: 0 0 0.25rem 0;
    font-size: 0.8125rem;
}

.dash-activity-time {
    color: #868e96;
    margin: 0;
    font-size: 0.8125rem;
}
</style>
{% endblock %}
